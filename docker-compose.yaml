version: '3.8'

services:
  freeswitch:
    build:
      context: .
      args:
        SIGNALWIRE_TOKEN: ${USER_TOKEN}   # Coolify env var'dan çekecek
    container_name: freeswitch-bridge
    restart: unless-stopped
    network_mode: host                    # En düşük latency için (NAT olmadan direkt host portları)
    ulimits:
      nofile: 65535
      rtprio: 99
    cap_add:
      - SYS_NICE
      - SYS_RESOURCE
    volumes:
      - freeswitch-config:/etc/freeswitch
      - freeswitch-logs:/var/log/freeswitch
      - freeswitch-db:/var/lib/freeswitch/db
      - freeswitch-recordings:/var/lib/freeswitch/recordings  # Pipecat için ses kaydı varsa
    environment:
      - TZ=Europe/Istanbul
    ports:                                # host network ile bile ports tanımlayabilirsin, ama gerek yok – host'ta direkt dinler
      - "5060:5060"
      - "5060:5060/udp"
      - "5080:5080"
      - "5080:5080/udp"
      - "8021:8021"                       # event socket
      # RTP için host network'te range otomatik açılır, config'de rtp-ip vs. ayarla
      # Eğer bridge network istersen: - "10000-20000:10000-20000/udp" ekle (ama latency artar)

volumes:
  freeswitch-config:
  freeswitch-logs:
  freeswitch-db:
  freeswitch-recordings:
