# docker-compose.yaml (Coolify yerine local test için, ama Coolify'ye uyarla)
version: '3.8'

services:
  freeswitch:
    build:
      context: .
      args:
        - SIGNALWIRE_TOKEN=${USER_TOKEN}  # Env var'dan çek
    container_name: freeswitch-bridge
    restart: unless-stopped
    network_mode: host  # Düşük latency için host network (direkt host portları kullan)
    ulimits:
      nofile: 65535  # Yüksek file limit, latency için
      rtprio: 99     # Realtime priority
    volumes:
      - ./freeswitch-config:/etc/freeswitch  # Config'leri dışarı al, düşük latency ayarları için tweak et
      - ./freeswitch-logs:/var/log/freeswitch
      - ./freeswitch-db:/var/lib/freeswitch/db
    environment:
      - TZ=Europe/Istanbul  # Zaman dilimi
    cap_add:
      - SYS_NICE  # Priority için
      - SYS_RESOURCE

# Kullanıcı yorumlarından (Reddit/X/forumlardan derlenmiş tips):
# - RTP range'i vars.conf.xml'de 10000-20000 olarak sınırlı tut, autoflush enable.
# - WebSocket için mod_audio_stream.conf.xml'de chunk size 30ms, overlap 10ms kullan (düşük latency stream).
# - Docker'da CPU affinity pinle (taskset), ama compose'da cpuset-cpus ile.
# - SignalWire token ile binary kurulum hızlı, source compile kaçın.
# Başarılı build'ler için: Coolify low RAM'de -j1 ile derle, ama burada binary.
